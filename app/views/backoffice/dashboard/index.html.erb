<!-- Header com Saudação -->
<div class="mb-6">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
        <span class="material-symbols-outlined text-primary text-2xl">person</span>
      </div>
      <div>
        <%= render 'shared/ui/heading',
            text: "#{greeting}, #{@user.name || @account.name}!",
            size: :xl,
            class: "mb-0" %>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          <%= format_date_long %>
        </p>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <% if @daily_goal > 0 %>
        <%= render 'shared/ui/badge',
            text: safe_join(["META: ", price_display(@daily_goal)]),
            variant: :success %>
      <% end %>
      <!-- Ícone de notificações (futuro) -->
      <button type="button" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
        <span class="material-symbols-outlined text-2xl">notifications</span>
      </button>
    </div>
  </div>
</div>

<!-- Card Principal: Vendas de Hoje -->
<%= render 'shared/ui/card', class: "mb-5" do %>
  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-4">VENDAS DE HOJE</p>
  <div class="flex items-end justify-between mb-3">
    <p class="text-4xl font-bold" style="color: var(--color-primary);">
      <%= price_display(@today_total, size: :large) %>
    </p>
    <% if @growth_percentage != 0 %>
      <div class="flex items-center gap-1 <%= @growth_percentage > 0 ? 'text-green-600' : 'text-red-600' %>">
        <span class="material-symbols-outlined text-xl">
          <%= @growth_percentage > 0 ? 'trending_up' : 'trending_down' %>
        </span>
        <span class="text-lg font-bold">
          <%= @growth_percentage > 0 ? '+' : '' %><%= @growth_percentage %>%
        </span>
      </div>
    <% end %>
  </div>
  <% if @last_week_total > 0 %>
    <p class="text-sm text-gray-600 dark:text-gray-400">
      <%= @growth_percentage > 0 ? 'Acima' : @growth_percentage < 0 ? 'Abaixo' : 'Igual' %> da média de <%= @day_name %>
    </p>
  <% elsif @today_total > 0 %>
    <p class="text-sm text-gray-600 dark:text-gray-400">Primeira venda de hoje!</p>
  <% else %>
    <p class="text-sm text-gray-600 dark:text-gray-400">Nenhuma venda ainda hoje</p>
  <% end %>

  <div class="mt-4 flex justify-end">
    <%= link_to daily_summary_backoffice_reports_path,
        class: "text-xs font-semibold text-primary hover:underline flex items-center gap-1" do %>
      Ver resumo detalhado do dia
      <span class="material-symbols-outlined text-sm">chevron_right</span>
    <% end %>
  </div>
<% end %>

<!-- Grid de Métricas (2 colunas) -->
<div class="grid grid-cols-2 gap-4 mb-5">
  <%= render 'shared/ui/metric_card',
      label: "PEDIDOS",
      value: @today_count,
      change: @orders_change,
      change_type: @orders_change >= 0 ? :positive : :negative %>
  
  <%= render 'shared/ui/metric_card',
      label: "TICKET MÉDIO",
      value: @avg_ticket,
      change: @ticket_change,
      change_type: @ticket_change >= 0 ? :positive : :negative,
      value_type: :currency %>
</div>

<!-- Seção de Alertas -->
<% if @low_stock_products.any? %>
  <div class="mb-5">
    <%= render 'shared/ui/heading', text: "Alertas", size: :lg, class: "mb-3" %>
    <%= render 'shared/ui/alert_card',
        products: @low_stock_products,
        count: @low_stock_products.count,
        link_path: low_stock_backoffice_products_path %>
  </div>
<% end %>

<!-- Seção de Atalhos -->
<div class="mb-5">
  <%= render 'shared/ui/heading', text: "Atalhos", size: :lg, class: "mb-3" %>
  <div class="grid grid-cols-2 gap-4">
    <!-- Botão Nova Venda -->
    <%= link_to new_backoffice_sale_path, 
        class: "bg-primary rounded-2xl p-6 flex flex-col items-center justify-center gap-3 shadow-sm hover:shadow-md transition-shadow" do %>
      <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
        <span class="material-symbols-outlined text-white text-3xl">shopping_cart</span>
      </div>
      <p class="text-white font-bold text-base">Nova Venda</p>
    <% end %>
    
    <!-- Botão Cadastrar Produto -->
    <%= link_to new_backoffice_product_path,
        class: "bg-white dark:bg-[#1a2e20] border-2 border-gray-200 dark:border-gray-800 rounded-2xl p-6 flex flex-col items-center justify-center gap-3 shadow-sm hover:shadow-md transition-shadow" do %>
      <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center relative">
        <span class="material-symbols-outlined text-primary text-3xl">grid_view</span>
        <span class="material-symbols-outlined text-primary text-lg absolute bottom-0 right-0">edit</span>
      </div>
      <p class="text-[#0e1b12] dark:text-white font-bold text-base">Cadastrar Produto</p>
    <% end %>
  </div>
</div>

<!-- Empty State (se não houver vendas) -->
<% if @today_sales.empty? && @low_stock_products.empty? %>
  <div class="mb-5">
    <%= render 'shared/ui/empty_card',
        title: "Pronto para começar?",
        description: "Registre sua primeira venda e acompanhe seu dia aqui.",
        cta_text: "Registrar venda agora",
        cta_path: new_backoffice_sale_path %>
  </div>
<% end %>

<!-- FAB (Floating Action Button) -->
<div class="fixed bottom-20 right-6 md:bottom-6 z-30">
  <%= render 'shared/ui/button',
      text: "",
      variant: :primary,
      size: :lg,
      href: new_backoffice_sale_path,
      class: "w-16 h-16 rounded-full shadow-xl" do %>
    <span class="material-symbols-outlined text-2xl">chat</span>
  <% end %>
</div>
