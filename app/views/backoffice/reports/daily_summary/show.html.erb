<div class="max-w-7xl mx-auto">
  <%= render 'backoffice/reports/shared/report_header',
      title: "Resumo do Dia" %>

  <%= render 'shared/ui/card', class: "mb-6" do %>
    <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-4">
      HOJE
    </p>

    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-4">
      <div>
        <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">
          Total vendido
        </p>
        <p class="text-4xl font-bold" style="color: var(--color-vendi-green-500);">
          <%= price_display(@summary.total_revenue, size: :large) %>
        </p>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
          <%= @summary.sales_count %> <%= @summary.sales_count == 1 ? "venda" : "vendas" %>
          • Ticket médio:
          <% if @summary.sales_count.positive? %>
            <%= price_display(@summary.avg_ticket) %>
          <% else %>
            —
          <% end %>
        </p>
      </div>

      <div class="md:text-right">
        <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">
          Lucro e margem
        </p>
        <p class="text-lg font-semibold text-[#0e1b12] dark:text-white">
          <%= price_display(@summary.total_profit || 0) %>
          <% if @summary.margin_percentage.present? %>
            <span class="text-sm text-gray-600 dark:text-gray-400">
              (Margem <%= number_with_precision(@summary.margin_percentage, precision: 1) %>%)
            </span>
          <% else %>
            <span class="text-sm text-gray-500 dark:text-gray-400">
              (margem indisponível sem vendas)
            </span>
          <% end %>
        </p>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          Lucro calculado a partir do custo cadastrado nos produtos. Itens sem custo cadastrado não entram no cálculo de lucro.
        </p>
      </div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
      <%= render 'shared/ui/metric_card',
          label: "VENDAS",
          value: @summary.sales_count,
          change: 0,
          change_type: :positive %>

      <%= render 'shared/ui/metric_card',
          label: "TICKET MÉDIO",
          value: @summary.avg_ticket,
          change: 0,
          change_type: :positive,
          value_type: :currency %>

      <%= render 'shared/ui/metric_card',
          label: "LUCRO",
          value: @summary.total_profit || 0,
          change: 0,
          change_type: :positive,
          value_type: :currency %>

      <div class="bg-white dark:bg-[#1a2e20] rounded-xl border border-gray-100 dark:border-gray-800 shadow-sm p-4">
        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">
          MARGEM
        </p>
        <% if @summary.margin_percentage.present? %>
          <p class="text-2xl font-bold text-[#0e1b12] dark:text-white mb-1">
            <%= number_with_precision(@summary.margin_percentage, precision: 1) %>%
          </p>
        <% else %>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Indisponível sem vendas pagas hoje.
          </p>
        <% end %>
      </div>
    </div>
  <% end %>

  <%= render 'shared/ui/card', class: "mb-6" do %>
    <%= render 'shared/ui/heading',
        text: "Top produtos por lucro (hoje)",
        size: :lg,
        class: "mb-4" %>

    <% if @summary.top_products.any? %>
      <div class="divide-y divide-gray-100 dark:divide-gray-800">
        <% @summary.top_products.each_with_index do |product_row, index| %>
          <div class="flex items-center gap-4 py-3">
            <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-sm font-semibold text-primary shrink-0">
              <%= index + 1 %>
            </div>
            <div class="flex-1 min-w-0">
              <%= render 'backoffice/reports/shared/product_info',
                  product_name: product_row.product_name,
                  show_avatar: false %>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                <%= product_row.total_quantity.to_i %> <%= product_row.total_quantity.to_i == 1 ? "unidade" : "unidades" %>
                • Receita:
                <%= price_display(product_row.total_revenue || 0) %>
              </p>
            </div>
            <div class="text-right shrink-0">
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Lucro
              </p>
              <p class="text-sm font-bold text-[#0e1b12] dark:text-white">
                <%= price_display(product_row.total_profit || 0) %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-sm text-gray-500 dark:text-gray-400">
        Ainda não há produtos com lucro registrado hoje. Assim que você registrar vendas com custo cadastrado, os destaques aparecerão aqui.
      </p>
    <% end %>
  <% end %>
</div>
