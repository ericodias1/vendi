<%
  current_path = request.path
  role_labels = {
    'owner' => 'Proprietário',
    'employee' => 'Gerente',
    'manager' => 'Gerente'
  }
  user_role_label = current_user&.role ? (role_labels[current_user.role] || 'Funcionário') : 'Funcionário'
%>

<aside class="fixed md:static inset-y-0 left-0 z-50 w-64 bg-sidebar-bg border-r border-slate-200 flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out"
       data-sidebar-target="sidebar">
  <!-- Logo/Brand -->
  <div class="h-16 flex items-center px-6 border-b border-slate-200 justify-between gap-2">
    <%= link_to backoffice_root_path, class: "flex items-center flex-1 min-w-0" do %>
      <!-- Logo completo em desktop -->
      <%= image_tag "vendi-gestao-logo.png", alt: "Vendi Gestão", class: "h-8 w-auto" %>
    <% end %>
    <!-- Notifications Button -->
    <button type="button"
            class="relative p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors shrink-0"
            aria-label="Notificações">
      <span class="material-symbols-outlined text-xl text-slate-700 dark:text-slate-300">notifications</span>
      <!-- Badge de contagem (quando houver notificações) -->
      <!-- <span class="absolute top-1 right-1 w-2 h-2 bg-error-500 rounded-full border-2 border-white"></span> -->
    </button>
    <!-- Close button (mobile only) -->
    <button type="button"
            class="p-2 rounded-md text-slate-700 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary cursor-pointer md:hidden shrink-0"
            data-action="click->sidebar#close"
            aria-label="Close menu">
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
    <% sidebar_menu_items.each do |item| %>
      <%= link_to item[:path], class: sidebar_item_classes(item, current_path) do %>
        <%= sidebar_icon(item[:icon]) %>
        <span><%= item[:label] %></span>
      <% end %>
    <% end %>
  </nav>

  <!-- User Profile Section -->
  <% if current_user.present? %>
    <div class="px-4 py-4 border-t border-slate-200">
      <div class="relative" data-controller="dropdown">
        <button type="button"
                class="flex items-center gap-3 w-full text-left"
                data-action="click->dropdown#toggle">
          <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center shrink-0">
            <% if current_user.name.present? %>
              <% initials = current_user.name.split.map { |n| n[0] }.join.upcase %>
              <span class="text-white font-medium text-sm">
                <%= initials[0..1] %>
              </span>
            <% else %>
              <span class="text-white font-medium text-sm">
                <%= current_user.email.first.upcase %>
              </span>
            <% end %>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-semibold text-slate-900 truncate">
              <%= current_user.name.presence || current_user.email.split('@').first %>
            </p>
            <p class="text-xs text-slate-600 truncate">
              <%= user_role_label %>
            </p>
          </div>
          <svg class="w-4 h-4 text-slate-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div class="hidden absolute bottom-full left-4 right-4 mb-2 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-50"
             data-dropdown-target="menu">
          <%= button_to logout_path, method: :delete,
              class: "block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 w-full text-left" do %>
            <span class="flex items-center gap-2">
              <span class="material-symbols-outlined text-lg">logout</span>
              Sair
            </span>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</aside>
