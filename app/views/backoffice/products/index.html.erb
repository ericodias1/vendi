<!-- Header -->
<div class="mb-6">
  <div class="mb-4 flex items-center justify-between">
    <%= render 'shared/ui/heading',
        text: "Produtos",
        size: :xl %>
  </div>

  <!-- Search Bar -->
  <div class="flex gap-3 mb-4">
    <%= form_with url: backoffice_products_path, method: :get, local: true, class: "flex flex-col w-full" do |f| %>
      <div class="flex w-full h-12 items-center bg-white dark:bg-surface-dark rounded-xl px-4 shadow-sm border border-gray-100 dark:border-gray-800">
        <span class="material-symbols-outlined text-gray-400 dark:text-gray-500 mr-2">search</span>
        <%= f.text_field :search, 
            value: params[:search],
            placeholder: "Buscar por nome...",
            class: "flex-1 bg-transparent border-none focus:ring-0 text-base placeholder:text-gray-400 dark:placeholder:text-gray-500 p-0" %>
      </div>
    <% end %>
    <!-- Desktop Buttons (top right) -->
    <div class="hidden md:flex items-center gap-2 shrink-0">
      <%= render 'shared/ui/view_mode_selector',
          current_mode: @account_config&.products_view_mode || "cards",
          cards_path: update_view_mode_backoffice_products_path(view_mode: 'cards', filter: params[:filter], search: params[:search], page: params[:page]),
          table_path: update_view_mode_backoffice_products_path(view_mode: 'table', filter: params[:filter], search: params[:search], page: params[:page]) %>
      <%= render 'shared/ui/button',
          text: "",
          variant: :secondary,
          size: :md,
          href: backoffice_product_imports_path,
          class: "items-center gap-2" do %>
        <span class="material-symbols-outlined">upload_file</span>
        <span>Importar</span>
      <% end %>
      <%= render 'shared/ui/button',
          text: "",
          variant: :primary,
          size: :md,
          href: new_backoffice_product_path,
          class: "items-center gap-2" do %>
        <span class="material-symbols-outlined">add_circle</span>
        <span>Novo produto</span>
      <% end %>
    </div>
  </div>

  <!-- Chips / Filters -->
  <%= render 'shared/ui/filter_chips',
      filters: [
        { key: nil, label: "Todos", path: backoffice_products_path(search: params[:search]) },
        { key: "low_stock", label: "Estoque baixo", path: backoffice_products_path(filter: "low_stock", search: params[:search]) },
        { key: "most_sold", label: "Mais vendidos", path: backoffice_products_path(filter: "most_sold", search: params[:search]) }
      ],
      active_filter: params[:filter] %>
</div>

<!-- Product List -->
<% if @products.any? %>
  <% view_mode = @account_config&.products_view_mode || "cards" %>
  
  <% if view_mode == "table" %>
    <%= render 'products_table', products: @products %>
  <% else %>
    <%= render 'products_cards', products: @products %>
  <% end %>
  
  <!-- Paginação -->
  <% if (@total_count || 0) > (@per_page || 20) %>
    <% 
      total_count = @total_count || 0
      per_page = @per_page || 20
      current_page = @page || 1
      total_pages = (total_count.to_f / per_page).ceil
    %>
    <div class="flex items-center justify-center gap-2 py-6">
      <% if current_page > 1 %>
        <%= link_to backoffice_products_path(filter: params[:filter], search: params[:search], page: current_page - 1),
            class: "px-4 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors" do %>
          Anterior
        <% end %>
      <% end %>
      
      <span class="px-4 py-2 text-sm text-zinc-600 dark:text-zinc-400">
        Página <%= current_page %> de <%= total_pages %>
      </span>
      
      <% if current_page < total_pages %>
        <%= link_to backoffice_products_path(filter: params[:filter], search: params[:search], page: current_page + 1),
            class: "px-4 py-2 text-sm font-medium text-zinc-700 dark:text-zinc-300 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors" do %>
          Próxima
        <% end %>
      <% end %>
    </div>
  <% end %>
<% else %>
  <%= render 'shared/ui/empty_card',
      title: "Nenhum produto encontrado",
      description: "Cadastre seu primeiro produto para começar a gerenciar seu estoque.",
      cta_text: "Novo produto",
      cta_path: new_backoffice_product_path %>
<% end %>

<!-- Mobile FAB with Dropdown -->
<% current_view_mode = @account_config&.products_view_mode || "cards" %>
<%= render 'shared/ui/fab_dropdown', items: [
  { 
    icon: 'add_circle', 
    label: 'Novo produto', 
    href: new_backoffice_product_path 
  },
  { 
    icon: 'upload_file', 
    label: 'Importar produtos', 
    href: backoffice_product_imports_path 
  },
  { divider: true },
  { 
    icon: 'grid_view', 
    label: 'Ver em cards', 
    href: update_view_mode_backoffice_products_path(view_mode: 'cards', filter: params[:filter], search: params[:search], page: params[:page]),
    method: :patch,
    active: current_view_mode == 'cards'
  },
  { 
    icon: 'view_list', 
    label: 'Ver em tabela', 
    href: update_view_mode_backoffice_products_path(view_mode: 'table', filter: params[:filter], search: params[:search], page: params[:page]),
    method: :patch,
    active: current_view_mode == 'table'
  }
] %>
