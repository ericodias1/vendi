<!-- Header -->
<header class="sticky -top-6 z-10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md px-4 pt-4 pb-2 mb-4">
  <div class="flex items-center gap-4">
    <%= render 'shared/ui/back_link', path: backoffice_products_path, only_icon: true %>
    <%= render 'shared/ui/heading',
        text: "Histórico de importações",
        size: :lg %>
  </div>
  <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">Visualize e reverta importações de produtos.</p>
</header>

<main class="max-w-7xl mx-auto pb-32 px-4">
  <div class="mb-4 flex flex-wrap gap-2">
    <%= render 'shared/ui/button',
        text: "",
        variant: :primary,
        size: :md,
        href: new_backoffice_product_import_path,
        class: "items-center gap-2" do %>
      <span class="material-symbols-outlined">upload</span>
      <span>Nova importação</span>
    <% end %>
    <%= render 'shared/ui/button',
        variant: :secondary,
        size: :md,
        href: export_csv_backoffice_products_path,
        class: "items-center gap-2",
        data: { turbo: false } do %>
      <span class="material-symbols-outlined">download</span>
      <span>Baixar CSV da base</span>
    <% end %>
  </div>

  <% if @product_imports.any? %>
    <div class="space-y-3">
      <% @product_imports.each do |import| %>
        <%= render 'shared/ui/card' do %>
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 min-w-0">
              <div>
                <p class="text-xs text-slate-500 dark:text-slate-400">Data</p>
                <p class="font-medium text-slate-900 dark:text-slate-100"><%= l(import.created_at, format: :short) %></p>
              </div>
              <div>
                <p class="text-xs text-slate-500 dark:text-slate-400">Tipo</p>
                <p class="font-medium text-slate-900 dark:text-slate-100"><%= import.source_type.upcase %></p>
              </div>
              <div>
                <p class="text-xs text-slate-500 dark:text-slate-400">Linhas / Sucesso / Falha</p>
                <p class="font-medium text-slate-900 dark:text-slate-100">
                  <%= import.total_rows || 0 %> / <%= import.successful_rows %> / <%= import.failed_rows %>
                </p>
              </div>
              <div>
                <p class="text-xs text-slate-500 dark:text-slate-400">Status</p>
                <%= render 'shared/ui/badge',
                    text: import.status_label,
                    variant: import.status == 'ready' ? :success : (import.status == 'completed' ? :success : (import.status == 'reverted' ? :warning : (import.status == 'failed' ? :error : :warning))) %>
              </div>
            </div>
            <div class="flex items-center gap-2 shrink-0">
              <%= link_to backoffice_product_import_path(import),
                  class: "inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors text-slate-700 dark:text-slate-300" do %>
                <span class="material-symbols-outlined text-sm">visibility</span>
                Ver
              <% end %>
              <% if import.revertible? %>
                <%= button_to revert_backoffice_product_import_path(import),
                    method: :post,
                    data: { turbo_confirm: "Tem certeza? Todos os produtos desta importação serão removidos." },
                    class: "inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium border border-red-200 dark:border-red-800 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-red-700 dark:text-red-400" do %>
                  <span class="material-symbols-outlined text-sm">undo</span>
                  Reverter
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <%= render 'shared/ui/empty_card',
        title: "Nenhuma importação",
        description: "Faça uma nova importação de produtos por CSV para ver o histórico aqui." do %>
      <%= render 'shared/ui/button',
          text: "Nova importação",
          variant: :primary,
          href: new_backoffice_product_import_path,
          class: "items-center gap-2" do %>
        <span class="material-symbols-outlined">upload</span>
      <% end %>
    <% end %>
  <% end %>
</main>
