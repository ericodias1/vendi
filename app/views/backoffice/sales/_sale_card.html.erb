<%
  sale = local_assigns[:sale]
  payment = sale.payment
%>

<%= link_to backoffice_sale_path(sale), class: "flex flex-col bg-white dark:bg-zinc-800 p-4 rounded-xl shadow-sm border border-zinc-50 dark:border-zinc-700 hover:shadow-md transition-shadow" do %>
  <div class="flex justify-between items-start">
    <p class="text-zinc-500 dark:text-zinc-400 text-sm font-medium"><%= [format_sale_time(sale), sale.customer&.name].compact.join(" • ") %></p>
    <p class="text-primary text-lg font-bold" style="color: var(--color-vendi-green-500);">
      <%= number_to_currency(sale.total_amount, unit: "R$ ", separator: ",", delimiter: ".") %>
    </p>
  </div>
  <div class="flex justify-between items-end">
    <div class="flex flex-col gap-2">
      <p class="text-[#0e1b12] dark:text-white text-base font-medium leading-tight">
        <%= sale_items_description(sale) %>
      </p>
      <div class="flex items-center gap-2 flex-wrap">
        <% if payment %>
          <div class="flex h-6 w-fit items-center justify-center rounded-full bg-primary/10 px-3">
            <p class="text-primary text-[10px] font-bold uppercase tracking-wider">
              <% payment_method_label = case payment.method
                   when "pix"
                     "Pix"
                   when "credit_card"
                     "Cartão de Crédito"
                   when "debit_card"
                     "Cartão de Débito"
                   when "cash"
                     "Dinheiro"
                   when "fiado"
                     "Fiado"
                   else
                     payment.method.humanize
                 end %>
              <%= payment_method_label %>
            </p>
          </div>
          <% payment_status_label = case payment.status
               when "paid"
                 "Pago"
               when "pending"
                 "Pendente"
               when "processing"
                 "Processando"
               when "failed"
                 "Falhou"
               when "refunded"
                 "Reembolsado"
               else
                 payment.status.humanize
             end %>
          <div class="flex h-6 w-fit items-center justify-center rounded-full <%= payment.paid? ? 'bg-green-100' : 'bg-amber-100' %> px-3">
            <p class="text-[10px] font-bold uppercase tracking-wider <%= payment.paid? ? 'text-green-700' : 'text-amber-700' %>">
              <%= payment_status_label %>
            </p>
          </div>
        <% end %>
      </div>
    </div>
    <div class="text-zinc-400">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </div>
  </div>
<% end %>
