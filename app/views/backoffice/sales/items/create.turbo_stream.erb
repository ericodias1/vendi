<%= turbo_stream.update "sale_items_section" do %>
  <% if @sale.sale_items.any? %>
    <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-tight mb-2 px-1">Itens na venda</p>
    <div id="sale_items_list" class="bg-white dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700 p-2">
      <% @sale.sale_items.each do |item| %>
        <%= render 'backoffice/sales/items/sale_item_footer', item: item, sale: @sale %>
      <% end %>
    </div>
  <% else %>
    <div id="sale_items_list" class="hidden"></div>
  <% end %>
<% end %>

<%= turbo_stream.replace "sale_summary" do %>
  <%= render 'backoffice/sales/steps/sale_summary', sale: @sale %>
<% end %>

<%= turbo_stream.update "continue_button" do %>
  <%= render 'shared/ui/button', 
      href: edit_backoffice_sale_details_path(@sale),
      variant: :primary,
      size: :lg,
      width: "w-full",
      class: @sale.sale_items.empty? ? 'opacity-50 cursor-not-allowed pointer-events-none' : '',
      disabled: @sale.sale_items.empty? do %>
    Continuar
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
  <% end %>
<% end %>

<%= turbo_stream.update "product_row_#{@product.id}" do %>
  <%= render 'backoffice/sales/products/product_list_row', product: @product, sale: @sale %>
<% end %>

<%= turbo_stream.append "toast-container" do %>
  <%= render 'shared/ui/toast', type: :success, message: "Produto adicionado ao carrinho!" %>
<% end %>
