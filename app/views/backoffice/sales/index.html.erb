<!-- TopAppBar -->
<div class="flex items-center bg-background-light dark:bg-background-dark p-4 pb-2 justify-between sticky top-0 z-10">
  <%= render 'shared/ui/heading', text: "Vendas", size: :lg, class: "flex-1 mb-0" %>
  <div class="flex w-12 items-center justify-end">
    <%= render 'shared/ui/button', variant: :secondary, size: :sm, class: "rounded-full h-10 w-10 p-0" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
      </svg>
    <% end %>
  </div>
</div>

<!-- Headline & MetaText -->
<div class="px-4 pt-4">
  <%= render 'shared/ui/heading',
      text: "Vendas",
      size: :xl,
      description: "Acompanhe rapidamente o que foi vendido." %>
</div>

<!-- Chips / Filter Section -->
<div class="p-4">
  <%= render 'shared/ui/filter_chips', 
      filters: [
        { key: 'today', label: 'Hoje', path: backoffice_sales_path(period: 'today') },
        { key: 'week', label: '7 dias', path: backoffice_sales_path(period: 'week') },
        { key: 'month', label: 'MÃªs', path: backoffice_sales_path(period: 'month') }
      ],
      active_filter: @active_period %>
</div>

<!-- Drafts Section -->
<% if @drafts.any? %>
  <div class="px-4 mt-2">
    <%= render 'shared/ui/heading', text: "Rascunhos", size: :md, class: "mb-3" %>
    <div class="flex flex-col gap-3">
      <% @drafts.each do |draft| %>
        <div class="relative flex flex-col gap-3 bg-white dark:bg-zinc-800 p-4 rounded-xl shadow-sm border border-zinc-50 dark:border-zinc-700 hover:shadow-md transition-shadow">
          <%= link_to edit_backoffice_sale_products_path(draft), class: "flex flex-col gap-3 block pr-16" do %>
            <div class="flex items-center justify-between">
              <div>
                <%= render 'shared/ui/badge', text: "Rascunho", variant: :info, class: "mb-1" %>
                <p class="text-lg font-bold text-[#0e1b12] dark:text-white"><%= draft.sale_number %></p>
              </div>
              <div class="text-right">
                <p class="text-sm font-semibold text-gray-600 dark:text-gray-400"><%= draft.sale_items.count %> itens</p>
                <p class="text-lg font-bold text-[#0e1b12] dark:text-white"><%= number_to_currency(draft.total_amount || 0) %></p>
              </div>
            </div>
          <% end %>
          <%= link_to backoffice_sale_path(draft),
              data: { turbo_method: :delete, turbo_confirm: "Deseja realmente excluir este rascunho?" },
              class: "absolute top-4 right-4 text-sm text-red-600 dark:text-red-400 hover:underline" do %>
            Excluir
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<!-- Sales List -->
<div class="flex flex-col gap-3 px-4 mt-2 pb-32">
  <% if @sales.any? %>
    <% @sales.each do |sale| %>
      <%= render 'backoffice/sales/sale_card', sale: sale %>
    <% end %>
  <% elsif @drafts.empty? %>
    <%= render 'shared/ui/empty_card',
        title: "Nenhuma venda encontrada",
        description: "Registre sua primeira venda para comeÃ§ar a acompanhar suas vendas.",
        cta_text: "Registrar venda",
        cta_path: new_backoffice_sale_path %>
  <% end %>
</div>

<!-- FAB - Registrar Venda -->
<div class="fixed-footer">
  <%= render 'shared/ui/button', 
      href: new_backoffice_sale_path,
      variant: :primary,
      size: :lg,
      class: "pointer-events-auto w-full" do %>
    <i class="material-symbols-outlined">add</i>
    <span class="text-base font-bold">Registrar venda</span>
  <% end %>
</div>
